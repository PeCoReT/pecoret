<script>
import BaseLayout from '@/layout/base/BaseLayout.vue';
import { MarkdownEditor } from '@/components/editor';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import ModelCombobox from '@/components/combobox/ModelCombobox.vue';

export default {
    name: 'TranslationCreate',
    components: { ModelCombobox, MarkdownEditor, BaseLayout, Input, Button },
    data() {
        return {
            visible: false,
            templateId: this.$route.params.templateId,
            model: {
                name: null,
                recommendation: null,
                description: null,
                language: null,
                remediation: null
            },
            loading: false,
            languageChoices: null,
            breadcrumbs: [
                {
                    label: 'Vulnerability Templates',
                    route: this.$router.resolve({ name: 'VulnerabilityTemplateList' })
                },
                {
                    label: 'Detail',
                    route: this.$router.resolve({
                        name: 'VulnerabilityTemplateUpdate',
                        params: {
                            templateId: this.$route.params.templateId
                        }
                    })
                },
                {
                    label: 'Translation',
                    disabled: true
                }
            ]
        };
    },
    methods: {
        create() {
            this.$api.post(this.$api.e.vulnTemplateTranslationList, { vulnPk: this.templateId }, this.model).then((response) => {
                this.$toaster({
                    title: 'Created!',
                    duration: 3000,
                    detail: 'Translation created!'
                });
                this.$router.push({
                    name: 'VulnerabilityTemplateUpdate',
                    params: {
                        templateId: this.templateId
                    }
                });
            });
        }
    }
};
</script>

<template>
    <BaseLayout :breadcrumbs="breadcrumbs">
        <div class="col-span-12 card">
            <Form>
                <Field label="Language">
                    <ModelCombobox v-model="model.language" :api-endpoint="this.$api.e.projectsAvailableLanguages" label="Language" label-field="language" value-field="code">
                        <template #trigger="{ label }">
                            <Button class="justify-between text-muted-foreground" role="combobox" variant="outline">
                                {{ model.language ? label : 'Select language' }}
                                <i class="ml-2 h-4 w-4 shrink-0 opacity-50 fa fa-chevron-down" />
                            </Button>
                        </template>
                    </ModelCombobox>
                </Field>
                <Field label="Name">
                    <Input id="name" v-model="model.name" type="text"></Input>
                </Field>
                <Field label="Description">
                    <MarkdownEditor v-model="model.description"></MarkdownEditor>
                </Field>
                <Field label="Recommendation">
                    <MarkdownEditor v-model="model.recommendation"></MarkdownEditor>
                </Field>
                <Field label="Remediation">
                    <Input v-model="model.remediation"></Input>
                </Field>
                <Button class="w-full" @click="create">Save</Button>
            </Form>
        </div>
    </BaseLayout>
</template>
